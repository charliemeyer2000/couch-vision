rtabmap:
  ros__parameters:
    frame_id: base_link
    odom_frame_id: odom
    map_frame_id: map

    subscribe_depth: true
    subscribe_rgb: true
    subscribe_odom: true
    odom_sensor_sync: true
    approx_sync: true
    queue_size: 10

    publish_tf: true
    wait_for_transform: 0.2

    Mem/IncrementalMemory: "true"
    Mem/InitWMWithAllNodes: "false"
    Rtabmap/DetectionRate: "1.0"
    Rtabmap/TimeThr: "0.0"
    Rtabmap/MemoryThr: "0"

    # ORB features - increase for better keyframe creation
    Kp/MaxFeatures: "500"
    Kp/DetectorStrategy: "6"  # ORB
    Vis/FeatureType: "6"      # ORB - must match detector!
    GFTT/MinDistance: "5"

    Kp/NNStrategy: "1"
    Kp/MaxDepth: "5.0"

    # Disable odom features for external odometry
    Mem/UseOdomFeatures: "false"

    # Lower rehearsal threshold to keep more keyframes distinct
    Mem/RehearsalSimilarity: "0.2"
    Kp/BadSignRatio: "0.5"

    # Minimum features for valid keyframe - reject bad early frames
    Vis/MinInliers: "15"

    # Create intermediate nodes for denser graph
    Rtabmap/CreateIntermediateNodes: "true"

    Grid/Sensor: "1"
    Grid/RangeMax: "5.0"
    Grid/RangeMin: "0.1"
    Grid/CellSize: "0.2"
    Grid/3D: "false"
    Grid/MaxGroundHeight: "0.1"
    Grid/MaxObstacleHeight: "2.0"

    Db/Sqlite3InMemory: "true"

    rgb/image_transport: "compressed"
    depth/image_transport: "raw"
